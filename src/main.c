//###########################################################################
//
//							Built By ChenXu
//
//###########################################################################
//
//	FILE:	main.c
//
//	TTTLE:	Empty Project For F28335 & ccs6.0
//
//###########################################################################
//  Ver | dd mmm yyyy | Who  | Description of changes
// =====|=============|======|===============================================
//  0.0 | 18 Nov 2016 | Y.W. | empty project
//  0.1 | 22 Nov 2016 | Y.W. | zcs pfc project
//###########################################################################
//
//	Notics:
//		1.ram ==> 28335_RAM_lnk.cmd
//		2/flash ==> F28335.cmd
//		3.important function(flash) ==> #pragma CODE_SECTION(func1,"ramfuncs")
//										#pragma CODE_SECTION(func2,"ramfuncs")
//###########################################################################

#include "DSP28x_Project.h"
#include "math.h"
#include "C28x_FPU_FastRTS.h"
#include "WYLib28335.h"

//#define RuninFlash

// Prototype statements for functions found within this file.
__interrupt void adc_isr(void);
void InitVaPID(void);
void InitVbPID(void);
void InitVcPID(void);

void OLED_Init(void);
void OLED_Clear(void);
void OLED_Show1(void);
void OLED_Show2(void);

Uint16 Key_Scan(void);
void OLED_Gpioset(void);

PID Va_PID = PID_DEFAULTS;		// PID for Va
PID Vb_PID = PID_DEFAULTS;		// PID for Vb
PID Vc_PID = PID_DEFAULTS;		// PID for Vc

//parameters
//parameters
#define Va_A 0.021775f
#define Va_B -0.28495f
#define Va_bias 2009.09f
//#define Va_bias 2412.52f

#define Vb_A 0.021906f
#define Vb_B -0.37845f
#define Vb_bias 2008.41f
//#define Vb_bias 2410.36f

#define Vc_A 0.021913f
#define Vc_B -0.318777f
#define Vc_bias 2008.88f
//#define Vc_bias 2413.45f
/*#define Vb_A 0.021951f
#define Vb_B -0.32701f//15178f
#define Vb_bias 2025.19f

#define Vc_A 0.021923f
#define Vc_B -0.2518f
#define Vc_bias 2027.11f*/

#define Kpp 5.0f//5.0f//5.f//0.2f//0.3f//0.03f//0.1f//10.f//1.f
#define Kii 5.0f//5.0f//1.8f//0.9f//0.5f//1.0f//15.0f//6.0f//5.0f//10.f//20.f//4.8f//8.f//6.1f//5.1f//4.1f//0.3f//0.7f//567.f//50.f
//#define Kcc 0.03//0.03f

//#define Vref 15.0f
#define PI 3.1415926f

#define Vref 5.0f

#define KX5_STATUS	 	GpioDataRegs.GPBDAT.bit.GPIO61							//X5状态
#define KX4_STATUS	 	GpioDataRegs.GPADAT.bit.GPIO19							//X4状态
#define KX3_STATUS	 	GpioDataRegs.GPADAT.bit.GPIO17							//X3状态
#define KX2_STATUS	 	GpioDataRegs.GPBDAT.bit.GPIO62							//X2状态
#define KX1_STATUS	 	GpioDataRegs.GPADAT.bit.GPIO22							//X1状态

float Va,Vb,Vc,Va_max,Vb_max,Vc_max,Va_min,Vb_min,Vc_min,Va_range;
float count = 0;//用于微调
float i,N;
float M = 0.45;
float weitiao1 = 0;
float weitiao2 = 0;
float weitiao3 = 0;
float weitiao = 0;
float ss[1000] = {0.006283,0.012566,0.018848,0.025130,0.031411,0.037690,0.043968,0.050244,0.056519,0.062791,0.069060,0.075327,0.081591,0.087851,0.094108,0.100362,0.106611,0.112856,0.119097,0.125333,0.131564,0.137790,0.144011,0.150226,0.156434,0.162637,0.168833,0.175023,0.181206,0.187381,0.193549,0.199710,0.205863,0.212007,0.218143,0.224271,0.230389,0.236499,0.242599,0.248690,0.254771,0.260842,0.266902,0.272952,0.278991,0.285019,0.291036,0.297042,0.303035,0.309017,0.314987,0.320944,0.326888,0.332820,0.338738,0.344643,0.350534,0.356412,0.362275,0.368125,0.373959,0.379779,0.385584,0.391374,0.397148,0.402906,0.408649,0.414376,0.420086,0.425779,0.431456,0.437116,0.442758,0.448383,0.453990,0.459580,0.465151,0.470704,0.476238,0.481754,0.487250,0.492727,0.498185,0.503623,0.509041,0.514440,0.519817,0.525175,0.530511,0.535827,0.541121,0.546394,0.551646,0.556876,0.562083,0.567269,0.572432,0.577573,0.582690,0.587785,0.592857,0.597905,0.602930,0.607930,0.612907,0.617860,0.622788,0.627691,0.632570,0.637424,0.642253,0.647056,0.651834,0.656586,0.661312,0.666012,0.670686,0.675333,0.679953,0.684547,0.689114,0.693653,0.698165,0.702650,0.707107,0.711536,0.715936,0.720309,0.724653,0.728969,0.733255,0.737513,0.741742,0.745941,0.750111,0.754251,0.758362,0.762443,0.766493,0.770513,0.774503,0.778462,0.782391,0.786288,0.790155,0.793990,0.797794,0.801567,0.805308,0.809017,0.812694,0.816339,0.819952,0.823533,0.827081,0.830596,0.834078,0.837528,0.840945,0.844328,0.847678,0.850994,0.854277,0.857527,0.860742,0.863923,0.867071,0.870184,0.873262,0.876307,0.879316,0.882291,0.885231,0.888136,0.891007,0.893841,0.896641,0.899405,0.902134,0.904827,0.907484,0.910106,0.912692,0.915241,0.917755,0.920232,0.922673,0.925077,0.927445,0.929776,0.932071,0.934329,0.936550,0.938734,0.940881,0.942991,0.945063,0.947098,0.949096,0.951057,0.952979,0.954865,0.956712,0.958522,0.960294,0.962028,0.963724,0.965382,0.967001,0.968583,0.970127,0.971632,0.973099,0.974527,0.975917,0.977268,0.978581,0.979855,0.981091,0.982287,0.983445,0.984564,0.985645,0.986686,0.987688,0.988652,0.989576,0.990461,0.991308,0.992115,0.992883,0.993611,0.994301,0.994951,0.995562,0.996134,0.996666,0.997159,0.997613,0.998027,0.998402,0.998737,0.999033,0.999289,0.999507,0.999684,0.999822,0.999921,0.999980,1.000000,0.999980,0.999921,0.999822,0.999684,0.999507,0.999289,0.999033,0.998737,0.998402,0.998027,0.997613,0.997159,0.996666,0.996134,0.995562,0.994951,0.994301,0.993611,0.992883,0.992115,0.991308,0.990461,0.989576,0.988652,0.987688,0.986686,0.985645,0.984564,0.983445,0.982287,0.981091,0.979855,0.978581,0.977268,0.975917,0.974527,0.973099,0.971632,0.970127,0.968583,0.967001,0.965382,0.963724,0.962028,0.960294,0.958522,0.956712,0.954865,0.952979,0.951057,0.949096,0.947098,0.945063,0.942991,0.940881,0.938734,0.936550,0.934329,0.932071,0.929776,0.927445,0.925077,0.922673,0.920232,0.917755,0.915241,0.912692,0.910106,0.907484,0.904827,0.902134,0.899405,0.896641,0.893841,0.891007,0.888136,0.885231,0.882291,0.879316,0.876307,0.873262,0.870184,0.867071,0.863923,0.860742,0.857527,0.854277,0.850994,0.847678,0.844328,0.840945,0.837528,0.834078,0.830596,0.827081,0.823533,0.819952,0.816339,0.812694,0.809017,0.805308,0.801567,0.797794,0.793990,0.790155,0.786288,0.782391,0.778462,0.774503,0.770513,0.766493,0.762443,0.758362,0.754251,0.750111,0.745941,0.741742,0.737513,0.733255,0.728969,0.724653,0.720309,0.715936,0.711536,0.707107,0.702650,0.698165,0.693653,0.689114,0.684547,0.679953,0.675333,0.670686,0.666012,0.661312,0.656586,0.651834,0.647056,0.642253,0.637424,0.632570,0.627691,0.622788,0.617860,0.612907,0.607930,0.602930,0.597905,0.592857,0.587785,0.582690,0.577573,0.572432,0.567269,0.562083,0.556876,0.551646,0.546394,0.541121,0.535827,0.530511,0.525175,0.519817,0.514440,0.509041,0.503623,0.498185,0.492727,0.487250,0.481754,0.476238,0.470704,0.465151,0.459580,0.453990,0.448383,0.442758,0.437116,0.431456,0.425779,0.420086,0.414376,0.408649,0.402906,0.397148,0.391374,0.385584,0.379779,0.373959,0.368125,0.362275,0.356412,0.350534,0.344643,0.338738,0.332820,0.326888,0.320944,0.314987,0.309017,0.303035,0.297042,0.291036,0.285019,0.278991,0.272952,0.266902,0.260842,0.254771,0.248690,0.242599,0.236499,0.230389,0.224271,0.218143,0.212007,0.205863,0.199710,0.193549,0.187381,0.181206,0.175023,0.168833,0.162637,0.156434,0.150226,0.144011,0.137790,0.131564,0.125333,0.119097,0.112856,0.106611,0.100362,0.094108,0.087851,0.081591,0.075327,0.069060,0.062791,0.056519,0.050244,0.043968,0.037690,0.031411,0.025130,0.018848,0.012566,0.006283,0.000000,-0.006283,-0.012566,-0.018848,-0.025130,-0.031411,-0.037690,-0.043968,-0.050244,-0.056519,-0.062791,-0.069060,-0.075327,-0.081591,-0.087851,-0.094108,-0.100362,-0.106611,-0.112856,-0.119097,-0.125333,-0.131564,-0.137790,-0.144011,-0.150226,-0.156434,-0.162637,-0.168833,-0.175023,-0.181206,-0.187381,-0.193549,-0.199710,-0.205863,-0.212007,-0.218143,-0.224271,-0.230389,-0.236499,-0.242599,-0.248690,-0.254771,-0.260842,-0.266902,-0.272952,-0.278991,-0.285019,-0.291036,-0.297042,-0.303035,-0.309017,-0.314987,-0.320944,-0.326888,-0.332820,-0.338738,-0.344643,-0.350534,-0.356412,-0.362275,-0.368125,-0.373959,-0.379779,-0.385584,-0.391374,-0.397148,-0.402906,-0.408649,-0.414376,-0.420086,-0.425779,-0.431456,-0.437116,-0.442758,-0.448383,-0.453990,-0.459580,-0.465151,-0.470704,-0.476238,-0.481754,-0.487250,-0.492727,-0.498185,-0.503623,-0.509041,-0.514440,-0.519817,-0.525175,-0.530511,-0.535827,-0.541121,-0.546394,-0.551646,-0.556876,-0.562083,-0.567269,-0.572432,-0.577573,-0.582690,-0.587785,-0.592857,-0.597905,-0.602930,-0.607930,-0.612907,-0.617860,-0.622788,-0.627691,-0.632570,-0.637424,-0.642253,-0.647056,-0.651834,-0.656586,-0.661312,-0.666012,-0.670686,-0.675333,-0.679953,-0.684547,-0.689114,-0.693653,-0.698165,-0.702650,-0.707107,-0.711536,-0.715936,-0.720309,-0.724653,-0.728969,-0.733255,-0.737513,-0.741742,-0.745941,-0.750111,-0.754251,-0.758362,-0.762443,-0.766493,-0.770513,-0.774503,-0.778462,-0.782391,-0.786288,-0.790155,-0.793990,-0.797794,-0.801567,-0.805308,-0.809017,-0.812694,-0.816339,-0.819952,-0.823533,-0.827081,-0.830596,-0.834078,-0.837528,-0.840945,-0.844328,-0.847678,-0.850994,-0.854277,-0.857527,-0.860742,-0.863923,-0.867071,-0.870184,-0.873262,-0.876307,-0.879316,-0.882291,-0.885231,-0.888136,-0.891007,-0.893841,-0.896641,-0.899405,-0.902134,-0.904827,-0.907484,-0.910106,-0.912692,-0.915241,-0.917755,-0.920232,-0.922673,-0.925077,-0.927445,-0.929776,-0.932071,-0.934329,-0.936550,-0.938734,-0.940881,-0.942991,-0.945063,-0.947098,-0.949096,-0.951057,-0.952979,-0.954865,-0.956712,-0.958522,-0.960294,-0.962028,-0.963724,-0.965382,-0.967001,-0.968583,-0.970127,-0.971632,-0.973099,-0.974527,-0.975917,-0.977268,-0.978581,-0.979855,-0.981091,-0.982287,-0.983445,-0.984564,-0.985645,-0.986686,-0.987688,-0.988652,-0.989576,-0.990461,-0.991308,-0.992115,-0.992883,-0.993611,-0.994301,-0.994951,-0.995562,-0.996134,-0.996666,-0.997159,-0.997613,-0.998027,-0.998402,-0.998737,-0.999033,-0.999289,-0.999507,-0.999684,-0.999822,-0.999921,-0.999980,-1.000000,-0.999980,-0.999921,-0.999822,-0.999684,-0.999507,-0.999289,-0.999033,-0.998737,-0.998402,-0.998027,-0.997613,-0.997159,-0.996666,-0.996134,-0.995562,-0.994951,-0.994301,-0.993611,-0.992883,-0.992115,-0.991308,-0.990461,-0.989576,-0.988652,-0.987688,-0.986686,-0.985645,-0.984564,-0.983445,-0.982287,-0.981091,-0.979855,-0.978581,-0.977268,-0.975917,-0.974527,-0.973099,-0.971632,-0.970127,-0.968583,-0.967001,-0.965382,-0.963724,-0.962028,-0.960294,-0.958522,-0.956712,-0.954865,-0.952979,-0.951057,-0.949096,-0.947098,-0.945063,-0.942991,-0.940881,-0.938734,-0.936550,-0.934329,-0.932071,-0.929776,-0.927445,-0.925077,-0.922673,-0.920232,-0.917755,-0.915241,-0.912692,-0.910106,-0.907484,-0.904827,-0.902134,-0.899405,-0.896641,-0.893841,-0.891007,-0.888136,-0.885231,-0.882291,-0.879316,-0.876307,-0.873262,-0.870184,-0.867071,-0.863923,-0.860742,-0.857527,-0.854277,-0.850994,-0.847678,-0.844328,-0.840945,-0.837528,-0.834078,-0.830596,-0.827081,-0.823533,-0.819952,-0.816339,-0.812694,-0.809017,-0.805308,-0.801567,-0.797794,-0.793990,-0.790155,-0.786288,-0.782391,-0.778462,-0.774503,-0.770513,-0.766493,-0.762443,-0.758362,-0.754251,-0.750111,-0.745941,-0.741742,-0.737513,-0.733255,-0.728969,-0.724653,-0.720309,-0.715936,-0.711536,-0.707107,-0.702650,-0.698165,-0.693653,-0.689114,-0.684547,-0.679953,-0.675333,-0.670686,-0.666012,-0.661312,-0.656586,-0.651834,-0.647056,-0.642253,-0.637424,-0.632570,-0.627691,-0.622788,-0.617860,-0.612907,-0.607930,-0.602930,-0.597905,-0.592857,-0.587785,-0.582690,-0.577573,-0.572432,-0.567269,-0.562083,-0.556876,-0.551646,-0.546394,-0.541121,-0.535827,-0.530511,-0.525175,-0.519817,-0.514440,-0.509041,-0.503623,-0.498185,-0.492727,-0.487250,-0.481754,-0.476238,-0.470704,-0.465151,-0.459580,-0.453990,-0.448383,-0.442758,-0.437116,-0.431456,-0.425779,-0.420086,-0.414376,-0.408649,-0.402906,-0.397148,-0.391374,-0.385584,-0.379779,-0.373959,-0.368125,-0.362275,-0.356412,-0.350534,-0.344643,-0.338738,-0.332820,-0.326888,-0.320944,-0.314987,-0.309017,-0.303035,-0.297042,-0.291036,-0.285019,-0.278991,-0.272952,-0.266902,-0.260842,-0.254771,-0.248690,-0.242599,-0.236499,-0.230389,-0.224271,-0.218143,-0.212007,-0.205863,-0.199710,-0.193549,-0.187381,-0.181206,-0.175023,-0.168833,-0.162637,-0.156434,-0.150226,-0.144011,-0.137790,-0.131564,-0.125333,-0.119097,-0.112856,-0.106611,-0.100362,-0.094108,-0.087851,-0.081591,-0.075327,-0.069060,-0.062791,-0.056519,-0.050244,-0.043968,-0.037690,-0.031411,-0.025130,-0.018848,-0.012566,-0.006283};
int i1,i2,i3,NN;

Uint16 Read_Key =0;
//float32 a[1000];
int j = 0;
int mode = 0;


int main(void)
{
	// Step 1. Initialize System Control:
  	   InitSysCtrl();

	// Step 2. Initialize GPIO:
  	 EALLOW;
		GpioDataRegs.GPACLEAR.bit.GPIO0 = 1;    // Enable pull-up on GPIO0 (EPWM1A)
		GpioDataRegs.GPACLEAR.bit.GPIO1 = 1;    // Enable pull-up on GPIO1 (EPWM1B)
		GpioDataRegs.GPACLEAR.bit.GPIO2 = 1;    // Enable pull-up on GPIO0 (EPWM1A)
		GpioDataRegs.GPACLEAR.bit.GPIO3 = 1;    // Enable pull-up on GPIO1 (EPWM1B)
		GpioDataRegs.GPACLEAR.bit.GPIO4 = 1;    // Enable pull-up on GPIO0 (EPWM1A)
		GpioDataRegs.GPACLEAR.bit.GPIO5 = 1;    // Enable pull-up on GPIO1 (EPWM1B)
  	 EDIS;

  	   OLED_Gpioset();

	// Step 3. Clear all interrupts and initialize PIE vector table:
	// Disable CPU interrupts
	   DINT;

	// Initialize the PIE control registers to their default state.
	   InitPieCtrl();

   /*flash烧录去掉注释*/

	   MemCopy(&RamfuncsLoadStart, &RamfuncsLoadEnd, &RamfuncsRunStart);

	// Call Flash Initialization to setup flash waitstates
	// This function must reside in RAM
	   InitFlash();

	// Disable CPU interrupts and clear all CPU interrupt flags:
	   IER = 0x0000;
	   IFR = 0x0000;

	// Initialize the PIE vector table with pointers to the shell Interrupt
	// Service Routines (ISR).
	   InitPieVectTable();

	// Interrupts that are used in this example are re-mapped to
	// ISR functions found within this file.
	   EALLOW;  // This is needed to write to EALLOW protected registers
	   PieVectTable.ADCINT = &adc_isr;
	   EDIS;    // This is needed to disable write to EALLOW protected registers

	// Step 4. Initialize all the Device Peripherals:

	   ePWM_TBCLK_SYNC_disable(); // Stop all the TB clocks
	   Init_ePWM1();
	   Init_ePWM2();
	   Init_ePWM3();
	   ePWM_TBCLK_SYNC_enable(); // Start all the TB clocks synced

	   Config_ADC();	//ADC
	   InitVaPID();	//PID
	   InitVbPID();	//PID
	   InitVcPID();	//PID


	// Step 5. User specific code, enable interrupts:

//	   IER |= M_INT4;	//ECAP4.1
	   IER |= M_INT1;	//ADC1.6

//	   PieCtrlRegs.PIEIER4.bit.INTx1 = 1;	//ECAP
	   PieCtrlRegs.PIEIER1.bit.INTx6 = 1;	//ADC

	// Enable global Interrupts and higher priority real-time debug events:
	   EINT;   // Enable Global interrupt INTM
	   ERTM;   // Enable Global realtime interrupt DBGM

	// Step 6. IDLE loop. Just sit and loop forever (optional):
	   i = 0.0f;
	   N = 1000.0f;
	   Va_max = 0;
	   Vb_max = 0;
	   Vc_max = 0;
	   Va_min = 4096;
	   Vb_min = 4096;
	   Vc_min = 4096;

	   i1 = 0;
	   i2 = 333;
	   i3 = 666;
	   NN = 999;

	   OLED_Init();
	   OLED_Clear();
	   OLED_Show1();

	   for(;;)
	   {
		   if(!(KX1_STATUS&&KX2_STATUS&&KX3_STATUS&&KX4_STATUS&&KX5_STATUS) == 1)
			{
				   Key_Scan();
				   if(Read_Key == 1)		//boost
				   {
					   OLED_Clear();
					   mode = 0;
					   OLED_Show2();
				   }
				   if(Read_Key == 2)
				   {
					   weitiao1 = weitiao1 + 0.01;
					   weitiao2 = weitiao2 + 0.01;
					   weitiao3 = weitiao3 + 0.01;
					   M = M - weitiao1;
					   weitiao = 0;
				   }
			}
		   Read_Key = 0;
	   }
}

__interrupt void  adc_isr(void)
{
/*		if(mode == 1)
		{
				Va = (AdcMirror.ADCRESULT0 - Va_bias) * Va_A + Va_B;
				Vb = (AdcMirror.ADCRESULT1 - Vb_bias) * Vb_A + Vb_B;
				Vc = (AdcMirror.ADCRESULT2 - Vc_bias) * Vc_A + Vc_B;

				//PI计算
				Va_PID.Fdb = Va;
				Vb_PID.Fdb = Vb;
				Vc_PID.Fdb = Vc;
				Va_PID.Ref = Vref*sin(2.0f*(i)*PI/N);
				Vb_PID.Ref = Vref*sin(2.0f*(i)*PI/N+2.0f/3.0f*PI);
				Vc_PID.Ref = Vref*sin(2.0f*(i)*PI/N+4.0f/3.0f*PI);
				//    Va_PID.Ref = Vref*ss[i1];
				//    Vb_PID.Ref = Vref*ss[i2];
				//    Vc_PID.Ref = Vref*ss[i3];
				Va_PID.calc(&Va_PID);
				Vb_PID.calc(&Vb_PID);
				Vc_PID.calc(&Vc_PID);

				EALLOW;
				EPwm1Regs.CMPA.half.CMPA = Va_PID.Out + 750;
				EPwm2Regs.CMPA.half.CMPA = Vb_PID.Out + 750;
				EPwm3Regs.CMPA.half.CMPA = Vc_PID.Out + 750;
				EDIS;

				i1++;
				i2++;
				i3++;
				if(i1==NN)
					i1 = 0;
				if(i2==NN)
					i2 = 0;
				if(i3==NN)
					i3 = 0;
		}
		else
		{*/
				Va = AdcMirror.ADCRESULT0;
				if(Va>Va_max)
					Va_max = Va;
//				if(Va<Va_min)
//					Va_min = Va;
			if(count == 1000)
				{
					count = 0;
					Va_range = Va_max;
					if(Va_range>2905)
					{
						weitiao1 = weitiao1 + 0.0072;
						weitiao2 = weitiao2 + 0.0072;
						weitiao3 = weitiao3 + 0.0072;
						M = M - weitiao1;
					}
					Va_max = 0;
				}

				EPwm1Regs.CMPA.half.CMPA = (Uint16)(EPwm1Regs.TBPRD*(0.5+(M)*ss[i1]));
				EPwm2Regs.CMPA.half.CMPA = (Uint16)(EPwm1Regs.TBPRD*(0.5+(M)*ss[i2]));
				EPwm3Regs.CMPA.half.CMPA = (Uint16)(EPwm1Regs.TBPRD*(0.5+(M)*ss[i3]));
/*				EPwm1Regs.CMPA.half.CMPA = (Uint16)(EPwm1Regs.TBPRD*(0.5+M*ss[i1]));
				EPwm2Regs.CMPA.half.CMPA = (Uint16)(EPwm1Regs.TBPRD*(0.5+M*ss[i2]));
				EPwm3Regs.CMPA.half.CMPA = (Uint16)(EPwm1Regs.TBPRD*(0.5+M*ss[i3]));*/
//				weitiao = 0;
				i1++;
				i2++;
				i3++;
				if(i1==NN)
				{
					weitiao1 = 0;
					i1 = 0;
				}
				if(i2==NN)
				{
					i2 = 0;
					weitiao2 = 0;
				}
				if(i3==NN)
				{
					i3 = 0;
					weitiao3 = 0;
				}
//		}
				count++;
    // Reinitialize for next ADC sequence
    AdcRegs.ADCTRL2.bit.RST_SEQ1 = 1;         // Reset SEQ1
    AdcRegs.ADCST.bit.INT_SEQ1_CLR = 1;       // Clear INT SEQ1 bit
    PieCtrlRegs.PIEACK.all = PIEACK_GROUP1;   // Acknowledge interrupt to PIE

    return;
}


void InitVaPID()
{
	Va_PID.Kp = Kpp;
	Va_PID.Ki = Kii;
	Va_PID.Kd = 0.0f;
	Va_PID.Kc = 0.003f;
	Va_PID.OutMax = 650.0f;
	Va_PID.OutMin = -650.0f;
	Va_PID.Ref = 0;
	Va_PID.Ui = 0.0f;
	Va_PID.SatErr = 0.0f;
	Va_PID.Err0 = 0.0f;
	Va_PID.UiSatLimit = 8.0f;
	return;
}

void InitVbPID()
{
	Vb_PID.Kp = Kpp;
	Vb_PID.Ki = Kii;
	Vb_PID.Kd = 0.0f;
	Vb_PID.Kc = 0.003f;
	Vb_PID.OutMax = 650.0f;
	Vb_PID.OutMin = -650.0f;
	Vb_PID.Ref = 0;
	Vb_PID.Ui = 0.0f;
	Vb_PID.SatErr = 0.0f;
	Vb_PID.Err0 = 0.0f;
	Vb_PID.UiSatLimit = 8.0f;
	return;
}

void InitVcPID()
{
	Vc_PID.Kp = Kpp;
	Vc_PID.Ki = Kii;
	Vc_PID.Kd = 0.0f;
	Vc_PID.Kc = 0.003f;
	Vc_PID.OutMax = 650.0f;
	Vc_PID.OutMin = -650.0f;
	Vc_PID.Ref = 0;
	Vc_PID.Ui = 0.0f;
	Vc_PID.SatErr = 0.0f;
	Vc_PID.Err0 = 0.0f;
	Vc_PID.UiSatLimit = 8.0f;
	return;
}

